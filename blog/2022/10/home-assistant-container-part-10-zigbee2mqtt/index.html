<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><title itemprop=name>Home Assistant Container Part 10: Zigbee2MQTT :: Sequr</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/ itemprop=url><meta name=url content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/"><link rel=icon href=/favicon.ico><meta itemprop=name content="Home Assistant Container Part 10: Zigbee2MQTT"><meta itemprop=description content="In this tenth part of the Home Assistant Container series we’ll set up a Zigbee network using Zigbee2MQTT"><meta itemprop=datePublished content="2022-10-04T00:00:00+02:00"><meta itemprop=dateModified content="2023-11-20T00:00:00+01:00"><meta itemprop=wordCount content="1646"><meta itemprop=image content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,Zigbee,Zigbee2MQTT,MQTT,Z2M"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/cover.png"><meta name=twitter:title content="Home Assistant Container Part 10: Zigbee2MQTT"><meta name=twitter:description content="In this tenth part of the Home Assistant Container series we’ll set up a Zigbee network using Zigbee2MQTT"><meta property="og:url" content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/"><meta property="og:site_name" content="Sequr"><meta property="og:title" content="Home Assistant Container Part 10: Zigbee2MQTT"><meta property="og:description" content="In this tenth part of the Home Assistant Container series we’ll set up a Zigbee network using Zigbee2MQTT"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-10-04T00:00:00+02:00"><meta property="article:modified_time" content="2023-11-20T00:00:00+01:00"><meta property="article:tag" content="Home Automation"><meta property="article:tag" content="Home Assistant"><meta property="article:tag" content="Container"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Zigbee"><meta property="article:tag" content="Zigbee2MQTT"><meta property="og:image" content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/cover.png"><meta property="og:see_also" content="https://sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/"><meta property="og:see_also" content="https://sequr.be/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/"><meta property="og:see_also" content="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/"><meta name=description content="In this tenth part of the Home Assistant Container series we&rsquo;ll set up a Zigbee network using Zigbee2MQTT"><meta itemprop=description content="In this tenth part of the Home Assistant Container series we&rsquo;ll set up a Zigbee network using Zigbee2MQTT"><meta property="og:updated_time" content="2023-11-20T00:00:00+01:00"><link rel=sitemap type=application/xml title=Sitemap href=https://sequr.be/sitemap.xml><meta name=apple-mobile-web-app-title content="Sequr"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=webmention href=https://webmention.io/sequr.be/webmention><link rel=stylesheet href=/css/bundle.min.fcaa303b2ba3fbaa95b102dfd06e53ba0d671cfc2e6c076625e31dd5f3133ae8.css integrity="sha256-/KowOyuj+6qVsQLf0G5Tug1nHPwubAdmJeMd1fMTOug=" crossorigin=anonymous><script defer type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js integrity="sha256-FFRTJhp3VfUEKoVMQhNQHSFaj740wI0YHED4A/ExXnQ=" crossorigin=anonymous></script></head><body class=dark-theme><div class=wrapper><aside class="sidebar h-card background-image"><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class="sidebar-about hcard"><h1 class=brand><a href=https://sequr.be/><img src=/logo.png class="u-logo u-photo" alt="Sequr brand image">
</a><a href=https://sequr.be/ class="u-url p-org"><h1>Sequr</h1></a></h1><p class="lead p-note">Writeups and random stuff about infosec and life</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/ title=About>About</a></li><li class=heading><a href=/blog/ title=Blog>Blog</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://sequr.be/blog/2025/01/bridging-this-blog-with-the-fediverse/ title="Bridging this blog with the Fediverse">Briding with the Fediverse</a></li><li class=bullet><a href=https://sequr.be/blog/2025/01/new-year-new-theme-for-the-site/ title="New year, new theme for the site">New theme</a></li><li class=bullet><a href=https://sequr.be/blog/2024/09/flashing-the-ikea-vindriktning-with-tasmota-and-esphome/ title="Flashing the IKEA Vindriktning with Tasmota and ESPHome">IKEA Vindriktning in HA</a></li><li class=bullet><a href=https://sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/ title="Home Assistant Container Part 13: VS Code code-server">HA Containter pt13: VS Code</a></li><li class=bullet><a href=https://sequr.be/blog/2024/02/flash-xiaomi-lywsd03mmc-ble-sensor-with-zigbee-firmware/ title="Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware">Xiaomi LYWSD03MMC with Zigbee</a></li><li class=heading><a href=/shoppinglist/ title=Shopping>Shopping</a></li><li class=heading><a href=/privacy/ title=Privacy>Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/blog/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg>
</a><a href=https://bsky.app/profile/sequr.be target=_blank class="u-url social" rel="external noopener me" title=Bluesky><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://mastodon-belgium.be/@TerraGloba target=_blank class="u-url social" rel="external noopener me" title=Mastodon><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18V8.91z"/></svg></a><a href=https://github.com/TheGroundZero target=_blank class="u-url social" rel="external noopener me" title=Github><svg width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a href=https://twitter.com/DezeStijn target=_blank class="u-url social" rel="external noopener me" title=Twitter><svg width="1.2em" height="1.2em" viewBox="0 0 16 16"><path fill="currentcolor" d="M5.032 14.286c6.037.0 9.34-4.837 9.34-9.032.0-.137.0-.274-.01-.41A6.56 6.56.0 0016 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207.0 001.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322.0 00-1.862-.958 3.384 3.384.0 00-2.082.334 3.223 3.223.0 00-1.442 1.49 3.08 3.08.0 00-.208 2.03 9.57 9.57.0 01-3.747-.963A9.269 9.269.0 011.114 2.292a3.086 3.086.0 00-.36 2.314c.189.787.68 1.475 1.376 1.924A3.344 3.344.0 01.64 6.132v.04c0 .734.263 1.444.743 2.01a3.3 3.3.0 001.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19.0 001.168 1.577 3.36 3.36.0 001.9.627A6.732 6.732.0 010 12.86a9.527 9.527.0 005.032 1.423"/></svg></a><a href=https://ko-fi.com/s4squatch target=_blank class="u-url social" rel="external noopener" title=Kofi><svg width="1.2em" height="1.2em" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>Sequr</a>
• <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="external noopener">CC BY-NC-SA 4.0</a></p></div></aside><section class="content container"><article class="post h-entry"><header class=info><h1 class="post-title p-name u-url"><a href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/>Home Assistant Container Part 10: Zigbee2MQTT</a></h1><div class=headline><div><span class="h-card p-author">DezeStijn
</span><span class=whitespace>• </span><time datetime=2022-10-04T00:00:00+0200 class="post-date dt-published">Oct 4, 2022
</time><span class=whitespace></span><time datetime=2023-11-20T00:00:00+0100 class="post-date dt-updated">(Nov 20, 2023)
</time><span class=whitespace>• </span><span class=reading-time><span>8 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a class=p-category href=https://sequr.be/categories/home-automation>Home Automation</a></li><li class="tag-HA Container"><a class=p-category href=https://sequr.be/categories/ha-container>HA Container</a></li></ul></div><p class=seriesname>Series: <a class=p-category href=https://sequr.be/series/ha-container>HA Container</a></p></header><main class=e-content><h2 id=intro>Intro</h2><p>Zigbee is a wireless protocol, like WiFi, but developed specifically for (battery powered) Internet-of-Things devices.
Devices connect in a mesh network, where mains powered devices (e.g. light bulbs and smart plugs) act as repeaters to extend the range of the network.
The Zigbee coordinator is at the heart of the Zigbee network and allows interconnectivity with non-Zigbee devices.</p><p>Home Assistant offers 2 Zigbee integrations: the built-in <a href=https://www.home-assistant.io/integrations/zha/ title="Zigbee Home Automation - ZHA" rel=external target=_blank>ZHA</a>, and <a href=https://www.home-assistant.io/integrations/deconz/ title=deCONZ rel=external target=_blank>deCONZ</a> which works via an add-on.
Another popular alternative is <a href=https://www.zigbee2mqtt.io/guide/usage/integrations/home_assistant.html title=Zigbee2MQTT rel=external target=_blank>Zigbee2MQTT</a> which makes use of Home Assistant&rsquo;s <a href=https://www.home-assistant.io/docs/mqtt/discovery/ title="MQTT Discovery" rel=external target=_blank>MQTT Discovery</a> to create devices and entities in Home Assistant.</p><p>Which coordinator you use is up to you.
I advise to check the <a href=https://zigbee.blakadder.com/ title="Zigbee Device Compatibility Repository by Blakadder" rel=external target=_blank>Zigbee Device Compatibility Repository</a> by Blakadder to check which coordinator supports the device you plan to buy.</p><p>This post will discuss the installation of Zigbee2MQTT as it makes use off a Docker container for the coordinator (we already installed the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">MQTT broker</a>).</p><p><strong>Note:</strong> This post got delayed somewhat because I had to wait for my <a href=https://s.click.aliexpress.com/e/_DDZbXfZ title="Robotsky USB Extension Cable USB 3.0" rel=external target=_blank>USB extension</a> cable to arrive.
Without it, my Zigbee controller was experiencing interference from my 2.4GHz WiFi on my miniPC.</p><h2 id=install-zigbee2mqtt-container>Install Zigbee2MQTT container</h2><h3 id=locate-zigbee-coordinator>Locate Zigbee coordinator</h3><p>In our Docker compose config, we&rsquo;ll need to assign the Zigbee coordinator, which&rsquo;ll be connected via USB, to the Docker container.</p><p>Plug in your Zigbee coordinator (e.g. Conbee II, Sonof Zigbee 3.0 Plus, &mldr;) into your machine.
Then run the following command to get the unique path to the device.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ls -l /dev/serial/by-id/
</span></span><span style=display:flex><span>usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_eexxx52-if00-port0 -&gt; ../../ttyUSB0
</span></span></code></pre></div><p>We&rsquo;ll use this unique <code>by-id</code> path in our config later instead of the typical <code>/dev/ttyUSB0</code> bevause there&rsquo;s always a risk of the device getting a new TTY assigned after a reboot, espcially with other devices pluggin in as well.</p><h3 id=docker-compose>Docker-compose</h3><p>We expand our <code>docker-compose.yaml</code> with the config for the Zigbee2MQTT container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>zigbee2mqtt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>koenkk/zigbee2mqtt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8099:8099/tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Europe/Brussels</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/opt/zigbee2mqtt/data:/app/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/run/udev:/run/udev:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/serial/by-id/usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_eexxx52-if00-port0:/dev/ttyACM0</span>
</span></span></code></pre></div><p>Note that I changed the port mapping for this container.
Port 8080 is already in use by <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">adminer</a> so I changed the Zigbee2MQTT front-end port to 8099 (see below) and mapped that one in my Docker configuration.</p><p>We won&rsquo;t start our container just yet, as we first want to setup our configuration.</p><h3 id=create-mqtt-user>Create MQTT user</h3><p>When we set up the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">Mosquitto MQTT broker</a>, I said I prefer to create a MQTT user per service.
So let&rsquo;s create a user for our Z2M container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it mosquitto mosquitto_passwd /mosquitto/config/mqttuser z2m_mqtt
</span></span><span style=display:flex><span>Password:          <span style=color:#75715e># Enter a password</span>
</span></span><span style=display:flex><span>Reenter password:  <span style=color:#75715e># Repeat the password</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat mosquitto/config/mqttuser
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>z2m_mqtt:$7$101$1xcB1yrF********$O$XR******************2/N************************************************************g<span style=color:#f92672>==</span>
</span></span></code></pre></div><h3 id=zigbee2mqtt-config>Zigbee2MQTT config</h3><p>To get a copy of the default config, run <code>sudo wget https://raw.githubusercontent.com/Koenkk/zigbee2mqtt/master/data/configuration.yaml</code> in the folder where the config will be stored (<code>/opt/zigbee2mqtt/data</code>).
Then open and edit it using <code>sudo nano /opt/zigbee2mqtt/data/configuration.yaml</code>.</p><p>We&rsquo;ll tell Z2M to connect to our <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">MQTT broker</a>, use the syntax Home Assistant device detection understands, set up the webserver, and let Z2M generate some keys used to setup the Zigbee network.</p><p>More info on what the settings in this config do, can be found in the <a href=https://www.zigbee2mqtt.io/guide/configuration/ title="Zigbee2MQTT documentation" rel=external target=_blank>Z2M docs</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Adapter settings</span>
</span></span><span style=display:flex><span><span style=color:#f92672>serial</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>/dev/ttyACM0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MQTT</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mqtt</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>base_topic</span>: <span style=color:#ae81ff>zigbee2mqtt</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>server</span>: <span style=color:#e6db74>&#39;!secret server&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#e6db74>&#39;!secret user&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#39;!secret password&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>client_id</span>: <span style=color:#ae81ff>zigbee</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Zigbee network</span>
</span></span><span style=display:flex><span><span style=color:#f92672>permit_join</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># Do not allow random devices to connect automatically</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Webserver</span>
</span></span><span style=display:flex><span><span style=color:#f92672>frontend</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8099</span> <span style=color:#75715e># Custom port</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#39;http://&lt;ip.of.our.box&gt;:8099&#39;</span> <span style=color:#75715e># Update IP here</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Devices and groups</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Extract config to separate files</span>
</span></span><span style=display:flex><span><span style=color:#f92672>devices</span>: <span style=color:#ae81ff>devices.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>groups</span>: <span style=color:#ae81ff>groups.yaml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Home Assistant integration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>homeassistant</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>advanced</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Zigbee network - auto-generate new keys</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pan_id</span>: <span style=color:#ae81ff>GENERATE</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>network_key</span>: <span style=color:#ae81ff>GENERATE</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Zigbee network - set channel to avoid interference with 2.4GHz WiFi</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>24</span>
</span></span></code></pre></div><h4 id=secrets-file>Secrets file</h4><p>You may have noticed the three <code>!secret</code> entries in the config above.
Those reference values we store in <code>secret.yaml</code> on the same level as our <code>configuration.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>: <span style=color:#e6db74>&#39;mqtt://ip.of.mosquitto.container&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>user</span>: <span style=color:#e6db74>&#39;z2m_mqtt&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>password</span>: <span style=color:#e6db74>&#39;MyVerySequrPassword&#39;</span>
</span></span></code></pre></div><h3 id=start-container>Start container</h3><p>With this configuration in place, we can start the container using <code>docker-compose up -d zigbee2mqtt</code>.</p><p>If you check the logs via Portainer or <code>docker-compose logs zigbee2mqtt</code>, you&rsquo;ll see our container start up nicely:</p><pre tabindex=0><code class=language-log data-lang=log>Using &#39;/app/data&#39; as data directory
Zigbee2MQTT:info  2022-10-04 12:09:47: Logging to console and directory: &#39;/app/data/log/2022-10-04.12-09-47&#39; filename: log.txt
Zigbee2MQTT:info  2022-10-04 12:09:47: Starting Zigbee2MQTT version 1.28.0 (commit #03ba647)
Zigbee2MQTT:info  2022-10-04 12:09:47: Starting zigbee-herdsman (0.14.62)
Zigbee2MQTT:info  2022-10-04 12:09:48: zigbee-herdsman started (resumed)
Zigbee2MQTT:info  2022-10-04 12:09:48: Coordinator firmware version: &#39;{&#34;meta&#34;:{&#34;maintrel&#34;:1,&#34;majorrel&#34;:2,&#34;minorrel&#34;:7,&#34;product&#34;:1,&#34;revision&#34;:20220219,&#34;transportrev&#34;:2},&#34;type&#34;:&#34;zStack3x0&#34;}&#39;
Zigbee2MQTT:info  2022-10-04 12:09:48: Currently 0 devices are joined:
Zigbee2MQTT:info  2022-10-04 12:09:48: Zigbee: disabling joining new devices.
Zigbee2MQTT:info  2022-10-04 12:09:48: Connecting to MQTT server at mqtt://&lt;ip.of.our.box&gt;:1883
Zigbee2MQTT:info  2022-10-04 12:09:48: Connected to MQTT server
Zigbee2MQTT:info  2022-10-04 12:09:48: MQTT publish: topic &#39;zigbee2mqtt/bridge/state&#39;, payload &#39;{&#34;state&#34;:&#34;online&#34;}&#39;
Zigbee2MQTT:info  2022-10-04 12:09:48: Started frontend on port 0.0.0.0:8099
Zigbee2MQTT:info  2022-10-04 12:09:48: MQTT publish: topic &#39;zigbee2mqtt/bridge/state&#39;, payload &#39;{&#34;state&#34;:&#34;online&#34;}&#39;
</code></pre><h2 id=home-assistant>Home Assistant</h2><h3 id=sidebar>Sidebar</h3><p>Repeating what we did in <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">Part 3</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/ title="Part 5: Node-RED">Part 5</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">Part 6</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/ title="Part 7: Backing up Home Assistant Container">Part 7</a>, and <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/ title="Part 9: ESPHome">Part 9</a>, we add an entry for ESPHome to the sidebar of our Home Assistant dashboard using <code>panel-iframe</code>.</p><p>Add the following lines to <code>configuration.yaml</code> and restart Home Assistant.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>panel_iframe</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>portainer</span>:     <span style=color:#75715e># part 3</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodered</span>:       <span style=color:#75715e># part 5</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>configurator</span>:  <span style=color:#75715e># part 6</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>duplicati</span>:     <span style=color:#75715e># part 7</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>esphome</span>:       <span style=color:#75715e># part 9</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Zigbee2MQTT</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:zigbee</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://192.168.10.106:8099</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>require_admin</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><figure class=center><img src=z2mdashboard.png alt="Zigbee2MQTT dashboard"><figcaption class=center>Zigbee2MQTT dashboard without devices</figcaption></figure><p>Pressing the <code>Permit join</code> button on the top-right will temporarily allow any Zigbee device set to pairing mode to be picked up by our coordinator.</p><figure class=center><img src=z2mjoin.png alt="Permit Zigbee to join"><figcaption class=center>Permit Zigbee to join</figcaption></figure><h3 id=controlling-z2m>Controlling Z2M</h3><p>Since Zigbee2MQTT&rsquo;s configuration can be adapted over MQTT, we can control Z2M not only from the Frontend we just exposed, but also from within our dashboard.
This is also explained in the <a href=https://www.zigbee2mqtt.io/guide/usage/integrations/home_assistant.html#controlling-zigbee2mqtt-via-home-assistant title="Controlling Z2M via Home Assistant" rel=external target=_blank>Z2M Home Assistant integration docs</a>.</p><p>First, we add some more YAML to our <code>configuration.yaml</code> via the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">Configurator</a>.
Copy and paste this code add the end of the file.
If you&rsquo;re used to splitting up your config and/or working with packages, you can put it in a <code>zigbee2mqtt.yaml</code> package file as well.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Input select for Zigbee2MQTT debug level</span>
</span></span><span style=display:flex><span><span style=color:#f92672>input_select</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_log_level</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Log Level</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>options</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>info</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>warn</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>error</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#ae81ff>info</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:format-list-bulleted</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Input number for joining time remaining (in minutes)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>input_number</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_join_minutes</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Zigbee2MQTT join minutes&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>min</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>step</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>slider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Input text to input Zigbee2MQTT friendly_name for scripts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>input_text</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_old_name</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Old Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_new_name</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT New Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_remove</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Remove</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Input boolean to set the force remove flag for devices</span>
</span></span><span style=display:flex><span><span style=color:#f92672>input_boolean</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_force_remove</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Force Remove</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:alert-remove</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Scripts for renaming &amp; removing devices</span>
</span></span><span style=display:flex><span><span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_rename</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee2MQTT Rename</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sequence</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>: <span style=color:#ae81ff>mqtt.publish</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>data_template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>topic</span>: <span style=color:#ae81ff>zigbee2mqtt/bridge/request/device/rename</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>payload_template</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;from&#34;: &#34;{{ states.input_text.zigbee2mqtt_old_name.state | string }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;to&#34;: &#34;{{ states.input_text.zigbee2mqtt_new_name.state | string }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          }</span>          
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee2mqtt_remove</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee2MQTT Remove</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sequence</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>: <span style=color:#ae81ff>mqtt.publish</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>data_template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>topic</span>: <span style=color:#ae81ff>zigbee2mqtt/bridge/request/device/remove</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>payload_template</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;id&#34;: &#34;{{ states.input_text.zigbee2mqtt_remove.state | string }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;force&#34;: {% if states.input_boolean.zigbee2mqtt_force_remove.state == &#34;off&#34; %}false{% else %}true{% endif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          }</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Timer for joining time remaining (254 sec)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>timer</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zigbee_permit_join</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Time remaining</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>254</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>mqtt</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Sensor for monitoring the bridge state</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Bridge state</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>unique_id</span>: <span style=color:#ae81ff>zigbee2mqtt_bridge_state_sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>state_topic</span>: <span style=color:#e6db74>&#34;zigbee2mqtt/bridge/state&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:router-wireless</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Sensor for Showing the Zigbee2MQTT Version</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Version</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>unique_id</span>: <span style=color:#ae81ff>zigbee2mqtt_version_sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>state_topic</span>: <span style=color:#e6db74>&#34;zigbee2mqtt/bridge/info&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value_template</span>: <span style=color:#e6db74>&#34;{{ value_json.version }}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:zigbee</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Sensor for Showing the Coordinator Version</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2MQTT Coordinator Version</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>unique_id</span>: <span style=color:#ae81ff>zigbee2mqtt_coordinator_version_sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>state_topic</span>: <span style=color:#e6db74>&#34;zigbee2mqtt/bridge/info&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value_template</span>: <span style=color:#e6db74>&#34;{{ value_json.coordinator.meta.revision }}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:chip</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Zigbee2mqtt Networkmap</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>unique_id</span>: <span style=color:#ae81ff>zigbee2mqtt_networkmap_sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># if you change base_topic of Zigbee2mqtt, change state_topic accordingly</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>state_topic</span>: <span style=color:#ae81ff>zigbee2mqtt/bridge/networkmap/raw</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value_template</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {{ now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) }}</span>        
</span></span><span style=display:flex><span>      <span style=color:#75715e># again, if you change base_topic of Zigbee2mqtt, change json_attributes_topic accordingly</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>json_attributes_topic</span>: <span style=color:#ae81ff>zigbee2mqtt/bridge/networkmap/raw</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#75715e># Switch for enabling joining</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>switch</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Zigbee2MQTT Main join&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>unique_id</span>: <span style=color:#ae81ff>zigbee2mqtt_main_join_switch</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>state_topic</span>: <span style=color:#e6db74>&#34;zigbee2mqtt/bridge/info&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value_template</span>: <span style=color:#e6db74>&#39;{{ value_json.permit_join | lower }}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command_topic</span>: <span style=color:#e6db74>&#34;zigbee2mqtt/bridge/request/permit_join&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>payload_on</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>payload_off</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>automation</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Automation for sending MQTT message on input select change</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee2MQTT Log Level</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial_state</span>: <span style=color:#e6db74>&#34;on&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>input_select.zigbee2mqtt_log_level</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>mqtt.publish</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>payload_template</span>: <span style=color:#e6db74>&#34;{{ states(&#39;input_select.zigbee2mqtt_log_level&#39;) }}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>topic</span>: <span style=color:#ae81ff>zigbee2mqtt/bridge/request/config/log_level</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Automation to start timer when enable join is turned on</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>zigbee_join_enabled</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee Join Enabled</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>switch.zigbee2mqtt_main_join</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#34;on&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>: <span style=color:#ae81ff>timer.start</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>timer.zigbee_permit_join</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>data_template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>duration</span>: <span style=color:#e6db74>&#34;{{ &#39;00:0%i:00&#39; % (states(&#39;input_number.zigbee2mqtt_join_minutes&#39;) | int ) }}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Automation to stop timer when switch turned off and turn off switch when timer finished</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>zigbee_join_disabled</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee Join Disabled</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>event</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>event_type</span>: <span style=color:#ae81ff>timer.finished</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>event_data</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>timer.zigbee_permit_join</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>switch.zigbee2mqtt_main_join</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#34;off&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>timer.cancel</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>timer.zigbee_permit_join</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>switch.turn_off</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>switch.zigbee2mqtt_main_join</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#e6db74>&#34;zigbee2mqtt_create_notification_on_successful_interview&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Zigbee Device Joined Notification</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>mqtt</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>topic</span>: <span style=color:#e6db74>&#39;zigbee2mqtt/bridge/event&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>condition</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value_template</span>: <span style=color:#e6db74>&#39;{{trigger.payload_json.type == &#34;device_interview&#34; and trigger.payload_json.data.status == &#34;successful&#34; and trigger.payload_json.data.supported}}&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>persistent_notification.create</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>data_template</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Device joined the Zigbee2MQTT network</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>message</span>: <span style=color:#e6db74>&#34;Name: {{trigger.payload_json.data.friendly_name}},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    Vendor: {{trigger.payload_json.data.definition.vendor}},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    Model: {{trigger.payload_json.data.definition.model}},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    Description: {{trigger.payload_json.data.definition.description}}&#34;</span>
</span></span></code></pre></div><p>Check your YAML config in the developer tools and restart Home Assistant.</p><p>Once that&rsquo;s done, you can add a custom card to your Dashboard containing the following entries:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Zigbee2MQTT</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>entities</span>
</span></span><span style=display:flex><span><span style=color:#f92672>show_header_toggle</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#f92672>entities</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>sensor.zigbee2mqtt_bridge_state</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>sensor.zigbee2mqtt_version</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>sensor.zigbee2mqtt_coordinator_version</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_select.zigbee2mqtt_log_level</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>divider</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>switch.zigbee2mqtt_main_join</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_number.zigbee2mqtt_join_minutes</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>timer.zigbee_permit_join</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>divider</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_text.zigbee2mqtt_old_name</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_text.zigbee2mqtt_new_name</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>script.zigbee2mqtt_rename</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>divider</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_text.zigbee2mqtt_remove</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>input_boolean.zigbee2mqtt_force_remove</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>entity</span>: <span style=color:#ae81ff>script.zigbee2mqtt_remove</span>
</span></span></code></pre></div><figure class=center><img src=hacard.png alt="Manage Zigbee2MQTT from Home Assistant"><figcaption class=center>Manage Z2M from Home Assistant</figcaption></figure><h3 id=network-map>Network map</h3><p>Another nice thing to add to Home Assistant is a map of your connect Zigbee devices.</p><p>Since we don&rsquo;t have any devices connected yet, this map will be fairly empty.
However, you&rsquo;ll enjoy seeing your network grow each time you add a new device :)</p><p>This will require you to add a <a href=https://github.com/azuwis/zigbee2mqtt-networkmap/ title="Z2M network map custom card" rel=external target=_blank>custom card</a>, either manually or using <a href=https://hacs.xyz/ title="Home Assistant Community Store (HACS)" rel=external target=_blank>HACS</a>.
I suggest you have a look at the documentation of both to decide which method you prefer.</p><figure class=center><img src=hamap.png alt="Zigbee2MQTT network map"><figcaption class=center>Zigbee2MQTT network map</figcaption></figure><p>Don&rsquo;t see the map or got an error about the custom card not existing?
Clear your cache and refresh the page before trying again.</p></main><hr><footer><div class=footer><p>This is a post in the <span style=font-weight:700><a href=https://sequr.be/series/ha-container>HA Container</a></span> series.<br>Other posts in this series:<ul class=series><li>Feb 12, 2024 -
<a href=/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/>Home Assistant Container Part 13: VS Code code-server</a></li><li>Dec 2, 2022 -
<a href=/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/>Home Assistant Container Part 12: Migrating to Podman</a></li><li>Nov 25, 2022 -
<a href=/blog/2022/11/home-assistant-container-part-11-bluetooth-support/>Home Assistant Container Part 11: Bluetooth support</a></li><li>Oct 4, 2022 -
Home Assistant Container Part 10: Zigbee2MQTT</li><li>Sep 15, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-9-esphome/>Home Assistant Container Part 9: ESPHome</a></li><li>Sep 11, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/>Home Assistant Container Part 8: Update Home Assistant Container</a></li><li>Sep 9, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/>Home Assistant Container Part 7: Backing up Home Assistant Container</a></li><li>Sep 8, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/>Home Assistant Container Part 6: Editing configuration.yaml from within Home Assistant</a></li><li>Sep 7, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-5-node-red/>Home Assistant Container Part 5: Node-RED</a></li><li>Sep 5, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/>Home Assistant Container Part 4: Mosquitto Docker Container</a></li><li>Sep 3, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/>Home Assistant Container Part 3: MariaDB and InfluxDB</a></li><li>Sep 2, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-2-home-assistant-container/>Home Assistant Container Part 2: Home Assistant Container</a></li><li>Aug 31, 2022 -
<a href=/blog/2022/08/home-assistant-container-part-1-install-debian-docker-and-portainer/>Home Assistant Container Part 1: Install Debian, Docker and Portainer</a></li></ul></p><p><div class=previous-post><a href="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/?ref=footer"><span style=font-weight:700>« Previous</span><br>Home Assistant Container Part 9: ESPHome</a><div class=next-post><a href="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/?ref=footer"><span style=font-weight:700>Next »</span><br>Home Assistant Container Part 11: Bluetooth...</a></div></p></div></footer></article></section><aside class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#install-zigbee2mqtt-container>Install Zigbee2MQTT container</a><ul><li><a href=#locate-zigbee-coordinator>Locate Zigbee coordinator</a></li><li><a href=#docker-compose>Docker-compose</a></li><li><a href=#create-mqtt-user>Create MQTT user</a></li><li><a href=#zigbee2mqtt-config>Zigbee2MQTT config</a><ul><li><a href=#secrets-file>Secrets file</a></li></ul></li><li><a href=#start-container>Start container</a></li></ul></li><li><a href=#home-assistant>Home Assistant</a><ul><li><a href=#sidebar>Sidebar</a></li><li><a href=#controlling-z2m>Controlling Z2M</a></li><li><a href=#network-map>Network map</a></li></ul></li></ul></nav></div></aside></div></body></html>