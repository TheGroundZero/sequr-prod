<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><title itemprop=name>Home Assistant Container Part 9: ESPHome :: Sequr</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/ itemprop=url><meta name=url content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/"><link rel=icon href=/favicon.ico><meta itemprop=name content="Home Assistant Container Part 9: ESPHome"><meta itemprop=description content="In this ninth part of the Home Assistant Container series we’ll add ESPHome to our Home Assistant Container install"><meta itemprop=datePublished content="2022-09-15T00:00:00+02:00"><meta itemprop=dateModified content="2022-10-04T00:00:00+02:00"><meta itemprop=wordCount content="1006"><meta itemprop=image content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,ESPHome"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/cover.png"><meta name=twitter:title content="Home Assistant Container Part 9: ESPHome"><meta name=twitter:description content="In this ninth part of the Home Assistant Container series we’ll add ESPHome to our Home Assistant Container install"><meta property="og:url" content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/"><meta property="og:site_name" content="Sequr"><meta property="og:title" content="Home Assistant Container Part 9: ESPHome"><meta property="og:description" content="In this ninth part of the Home Assistant Container series we’ll add ESPHome to our Home Assistant Container install"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-09-15T00:00:00+02:00"><meta property="article:modified_time" content="2022-10-04T00:00:00+02:00"><meta property="article:tag" content="Home Automation"><meta property="article:tag" content="Home Assistant"><meta property="article:tag" content="Container"><meta property="article:tag" content="Docker"><meta property="article:tag" content="ESPHome"><meta property="og:image" content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/cover.png"><meta property="og:see_also" content="https://sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/"><meta property="og:see_also" content="https://sequr.be/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/"><meta property="og:see_also" content="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/"><meta property="og:see_also" content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/"><meta name=description content="In this ninth part of the Home Assistant Container series we&rsquo;ll add ESPHome to our Home Assistant Container install"><meta itemprop=description content="In this ninth part of the Home Assistant Container series we&rsquo;ll add ESPHome to our Home Assistant Container install"><meta property="og:updated_time" content="2022-10-04T00:00:00+02:00"><link rel=sitemap type=application/xml title=Sitemap href=https://sequr.be/sitemap.xml><meta name=apple-mobile-web-app-title content="Sequr"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=stylesheet href=/css/bundle.min.fcaa303b2ba3fbaa95b102dfd06e53ba0d671cfc2e6c076625e31dd5f3133ae8.css integrity="sha256-/KowOyuj+6qVsQLf0G5Tug1nHPwubAdmJeMd1fMTOug=" crossorigin=anonymous><script defer type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js integrity="sha256-FFRTJhp3VfUEKoVMQhNQHSFaj740wI0YHED4A/ExXnQ=" crossorigin=anonymous></script></head><body class=dark-theme><div class=wrapper><aside class="sidebar h-card background-image"><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class="sidebar-about hcard"><h1 class=brand><a href=https://sequr.be/><img src=/logo.png class="u-logo u-photo" alt="Sequr brand image">
</a><a href=https://sequr.be/ class="u-url p-org"><h1>Sequr</h1></a></h1><p class="lead p-note">Writeups and random stuff about infosec and life</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/ title=About>About</a></li><li class=heading><a href=/blog/ title=Blog>Blog</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://sequr.be/blog/2025/01/new-year-new-theme-for-the-site/ title="New year, new theme for the site">New theme</a></li><li class=bullet><a href=https://sequr.be/blog/2024/09/flashing-the-ikea-vindriktning-with-tasmota-and-esphome/ title="Flashing the IKEA Vindriktning with Tasmota and ESPHome">IKEA Vindriktning in HA</a></li><li class=bullet><a href=https://sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/ title="Home Assistant Container Part 13: VS Code code-server">HA Containter pt13: VS Code</a></li><li class=bullet><a href=https://sequr.be/blog/2024/02/flash-xiaomi-lywsd03mmc-ble-sensor-with-zigbee-firmware/ title="Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware">Xiaomi LYWSD03MMC with Zigbee</a></li><li class=bullet><a href=https://sequr.be/blog/2023/12/remotely-opening-and-closing-my-gate/ title="Remotely opening and closing my gate">HA gate controller</a></li><li class=heading><a href=/shoppinglist/ title=Shopping>Shopping</a></li><li class=heading><a href=/privacy/ title=Privacy>Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/blog/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg>
</a><a href=https://bsky.app/profile/sequr.be target=_blank class="u-url social" rel="external noopener me" title=Bluesky><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://mastodon-belgium.be/@TerraGloba target=_blank class="u-url social" rel="external noopener me" title=Mastodon><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18V8.91z"/></svg></a><a href=https://github.com/TheGroundZero target=_blank class="u-url social" rel="external noopener me" title=Github><svg width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a href=https://twitter.com/DezeStijn target=_blank class="u-url social" rel="external noopener me" title=Twitter><svg width="1.2em" height="1.2em" viewBox="0 0 16 16"><path fill="currentcolor" d="M5.032 14.286c6.037.0 9.34-4.837 9.34-9.032.0-.137.0-.274-.01-.41A6.56 6.56.0 0016 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207.0 001.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322.0 00-1.862-.958 3.384 3.384.0 00-2.082.334 3.223 3.223.0 00-1.442 1.49 3.08 3.08.0 00-.208 2.03 9.57 9.57.0 01-3.747-.963A9.269 9.269.0 011.114 2.292a3.086 3.086.0 00-.36 2.314c.189.787.68 1.475 1.376 1.924A3.344 3.344.0 01.64 6.132v.04c0 .734.263 1.444.743 2.01a3.3 3.3.0 001.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19.0 001.168 1.577 3.36 3.36.0 001.9.627A6.732 6.732.0 010 12.86a9.527 9.527.0 005.032 1.423"/></svg></a><a href=https://ko-fi.com/s4squatch target=_blank class="u-url social" rel="external noopener" title=Kofi><svg width="1.2em" height="1.2em" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>Sequr</a>
• <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="external noopener">CC BY-NC-SA 4.0</a></p></div></aside><section class="content container"><article class="post h-entry"><header class=info><h1 class="post-title p-name u-url"><a href=https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/>Home Assistant Container Part 9: ESPHome</a></h1><div class=headline><div><span class="h-card p-author">DezeStijn
</span><span class=whitespace>• </span><time datetime=2022-09-15T00:00:00+0200 class="post-date dt-published">Sep 15, 2022
</time><span class=whitespace></span><time datetime=2022-10-04T00:00:00+0200 class="post-date dt-updated">(Oct 4, 2022)
</time><span class=whitespace>• </span><span class=reading-time><span>5 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a class=p-category href=https://sequr.be/categories/home-automation>Home Automation</a></li><li class="tag-HA Container"><a class=p-category href=https://sequr.be/categories/ha-container>HA Container</a></li></ul></div><p class=seriesname>Series: <a class=p-category href=https://sequr.be/series/ha-container>HA Container</a></p></header><main class=e-content><h2 id=intro>Intro</h2><p>If you like designing systems with ESP8266 and ESP32 microcontrollers, definitely check out <a href=https://esphome.io title=ESPHome rel=external target=_blank>ESPHome</a> if you haven&rsquo;t already.</p><p>By the end of this post, you&rsquo;ll have ESPHome installed, accessible via the Dashboard and connected to a device over USB.
In a future post (or a later edit of this post), we&rsquo;ll discuss setting up HTTPS so we can flash via the web browser.</p><h2 id=install-esphome-container>Install ESPHome container</h2><h3 id=docker-compose>Docker-compose</h3><p>We expand our <code>docker-compose.yaml</code> with the config for the ESPHome container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>esphome/esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;6052:6052/tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Europe/Brussels</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># mDNS doesn&#39;t work across VLANs, use static IP for devices when disabling mDNS</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   - ESPHOME_DASHBOARD_USE_PING=true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/opt/esphome/config:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># devices:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   - /dev/ttyUSB0:/dev/ttyUSB0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network_mode</span>: <span style=color:#ae81ff>host</span>
</span></span></code></pre></div><p>You&rsquo;ll have noticed a commented-out <code>devices</code> section.
We&rsquo;ll get back to this in a minute.</p><h3 id=start-and-access-esphome>Start and access ESPHome</h3><p>If we then run <code>docker-compose up -d</code> Docker will pull the image and will launch it.</p><p>Once running, the ESPHome dashboard can be reached at <code>http://&lt;ip.of.our.box>:6052</code>.</p><h2 id=home-assistant-sidebar>Home Assistant Sidebar</h2><p>We have done it <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">a</a> <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/ title="Part 5: Node-RED">few</a> <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">times</a> <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/ title="Part 7: Backing up Home Assistant Container">already</a>: add an entry for ESPHome to the sidebar of our Home Assistant dashboard using <code>panel-iframe</code>.</p><p>Add the following lines to <code>configuration.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>panel_iframe</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>portainer</span>:     <span style=color:#75715e># part 3</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodered</span>:       <span style=color:#75715e># part 5</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>configurator</span>:  <span style=color:#75715e># part 6</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>duplicati</span>:     <span style=color:#75715e># part 7</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>title</span>: <span style=color:#ae81ff>ESPHome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:chip</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://192.168.10.106:6052</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>require_admin</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>After a reboot, ESPHome will be accessible from within the Home Assistant Dashboard.</p><figure class=center><img src=esphomedashboard.png alt="ESPHome dashboard"><figcaption class=center>ESPHome dashboard without devices</figcaption></figure><h2 id=connecting-and-flashing-a-device>Connecting and flashing a device</h2><p>Let&rsquo;s imagine you want to set up an ESP to <a href=https://sequr.be/blog/2022/07/motion-triggered-led-strip-with-relays-to-minimize-power-consumption/ title="Motion-triggered LED strip with relays to minimize power consumption">control a LED strip and relais</a>.</p><p>You&rsquo;ll have to create a new device in the ESPHome dashboard and add the configuration you want to it.
Afterwards, you&rsquo;ll have to flash that configuration onto the ESP8266/ESP32 board.</p><figure class=center><img src=esphome_create.png alt="Create a new ESPHome device"><figcaption class=center>Create a new ESPHome device</figcaption></figure><p>Multiple options are available, but for the purpose of this posts we&rsquo;ll focus on the option <strong>Plug into the computer running ESPHome Dashboard</strong>.</p><figure class=center><img src=esphome_install.png alt="Install ESPHome configuration onto the device"><figcaption class=center>Install ESPHome configuration onto the device</figcaption></figure><p>Before you can chose this option, however, we&rsquo;ll first need to connect our ESP board to the Docker container.</p><h3 id=connecting-the-device-to-our-esphome-container>Connecting the device to our ESPHome container</h3><h4 id=identify-the-device>Identify the device</h4><p>First you&rsquo;ll need to figure out the path to the ESP when you connect it over USB to your Docker machine.</p><p>To do this, run the command <code>ls -l /sys/class/tty/*/device/driver</code> before and after connecting the ESP board via USB or <a href=https://www.aliexpress.com/item/32650148276.html title="FT232RL FTDI USB 3.3V 5.5V to TTL Serial Adapter Module" rel=external target=_blank>FTDI adapter</a>.
This command will show a list of all serial (TTY) devices on your system which have an actual driver for them installed (skipping virtual terminals).
You should notice an additional line appearing when you run the command after connecting the board.</p><p>For example</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ls -l /sys/class/tty/*/device/driver
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep  <span style=color:#ae81ff>4</span> 13:05 /sys/class/tty/ttyS0/device/driver -&gt; ../../../../bus/platform/drivers/dw-apb-uart
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS1/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS2/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS3/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Plugin the device (in this case a D1 ESP32)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ls -l /sys/class/tty/*/device/driver
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep  <span style=color:#ae81ff>4</span> 13:05 /sys/class/tty/ttyS0/device/driver -&gt; ../../../../bus/platform/drivers/dw-apb-uart
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS1/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS2/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:36 /sys/class/tty/ttyS3/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Sep <span style=color:#ae81ff>15</span> 15:54 /sys/class/tty/ttyUSB0/device/driver -&gt; ../../../../../../../bus/usb-serial/drivers/cp210x
</span></span></code></pre></div><p>Notice the line at the end for a USB serial device using the <a href=https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers title="CP210x USB to UART Bridge Virtual COM Port (VCP) driver" rel=external target=_blank>CP210x</a> USB to UART Bridge Virtual COM Port (VCP) driver.
Note that it is identified as <code>ttyUSB0</code>. This means we can address our device at <code>/dev/ttyUSB0</code>.</p><h4 id=forward-to-the-container>Forward to the container</h4><p>Remember the commented-out section?
Uncomment it and make sure the first section matches the path to your connected ESP.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># - [path to your device]:/dev/ttyUSB0</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/ttyUSB0:/dev/ttyUSB0</span>
</span></span></code></pre></div><p>This will map/mount your ESP microcontroller to <code>/dev/ttyUSB0</code> within the Docker container, allowing the ESPHome Dashboard to &ldquo;see&rdquo; it.</p><p>To finalise this device forwarding, you will need to rebuild the ESPHome container.
Save your changes and run <code>docker-compose up -d</code> so Docker recreates the container using our new config.</p><h3 id=install-configuration-on-the-esp>Install configuration on the ESP</h3><p>With the container restarted, go back to the ESPHome dashboard.
You&rsquo;ll find your device config listed there.</p><p>Press the 3 dots at the bottom-right of your device and choose <strong>Install</strong>.
Then &ndash; as said before &ndash; pick the option <strong>Plug into the computer running ESPHome Dashboard</strong>.</p><p>ESPHome will now show the connected device. Notice how the path is <code>/dev/ttyUSB0</code> and a CP2104 driver is used.</p><figure class=center><img src=esphome_port.png alt="Choose server port"><figcaption class=center>Choose server port</figcaption></figure><p>ESPHome will now turn your configuration in a firmware for the board and will flash it.
This may take a minute.</p><p>Once the device is flashed, ESPHome will be able to connect to the API and see data like the WiFi configuration.</p><figure class=center><img src=esphome_flash.png alt="Flashing ESPHome config onto an ESP32"><figcaption class=center>Flashing ESPHome config onto an ESP32</figcaption></figure><h3 id=add-device-to-home-assistant>Add device to Home Assistant</h3><p>With the board now flashed and connected to our WiFi, we still need to add the device to our Home Assistant install via the ESPHome integration.
This will allow us to read data from connected (and configured) sensors.</p><p>Home Assistant should&rsquo;ve automatically discovered the new ESPHome device and will send you a notification about this.
Clicking <strong>Check it out</strong> will send you to the integrations page, where the newly discovered device will be highlighted.</p><figure class=center><img src=ha_integration.png alt="A new ESPHome integration was discovered"><figcaption class=center>A new ESPHome integration was discovered</figcaption></figure><p>You can now add the device by clicking <strong>Configure</strong>.
However, you&rsquo;ll need the (randomly generated) <strong>API encryption key</strong>, which you can find in the ESPHome configuration of your device.</p><figure class=center><img src=esphome_config.png alt="ESPHome configuration of demo-sequr device"><figcaption class=center>Our ESPHome configuration</figcaption></figure><p>Copy the API encryption key and paste it when asked while configuring the ESPHome device.</p><p>Once added, you&rsquo;ll be able to view the device and (if applicable) entities created by the integration.
If you have sensors configured in the ESPHome config, you&rsquo;ll find these as entities in Home Assistant.</p><figure class=center><img src=ha_device.png alt="ESPHome device in Home Assistant"><figcaption class=center>ESPHome device in Home Assistant</figcaption></figure><p>Now we&rsquo;re ready to build custom devices using ESP8266/ESP32 board or flash existing devices (like Sonoff NSPanel) with a custom configuration.</p><p>Next, we&rsquo;ll install <a href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/ title="Part 10: Zigbee2MQTT">Zigbee2MQTT</a> so we can set up a Zigbee network.</p></main><hr><footer><div class=footer><p>This is a post in the <span style=font-weight:700><a href=https://sequr.be/series/ha-container>HA Container</a></span> series.<br>Other posts in this series:<ul class=series><li>Feb 12, 2024 -
<a href=/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/>Home Assistant Container Part 13: VS Code code-server</a></li><li>Dec 2, 2022 -
<a href=/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/>Home Assistant Container Part 12: Migrating to Podman</a></li><li>Nov 25, 2022 -
<a href=/blog/2022/11/home-assistant-container-part-11-bluetooth-support/>Home Assistant Container Part 11: Bluetooth support</a></li><li>Oct 4, 2022 -
<a href=/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/>Home Assistant Container Part 10: Zigbee2MQTT</a></li><li>Sep 15, 2022 -
Home Assistant Container Part 9: ESPHome</li><li>Sep 11, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/>Home Assistant Container Part 8: Update Home Assistant Container</a></li><li>Sep 9, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/>Home Assistant Container Part 7: Backing up Home Assistant Container</a></li><li>Sep 8, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/>Home Assistant Container Part 6: Editing configuration.yaml from within Home Assistant</a></li><li>Sep 7, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-5-node-red/>Home Assistant Container Part 5: Node-RED</a></li><li>Sep 5, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/>Home Assistant Container Part 4: Mosquitto Docker Container</a></li><li>Sep 3, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/>Home Assistant Container Part 3: MariaDB and InfluxDB</a></li><li>Sep 2, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-2-home-assistant-container/>Home Assistant Container Part 2: Home Assistant Container</a></li><li>Aug 31, 2022 -
<a href=/blog/2022/08/home-assistant-container-part-1-install-debian-docker-and-portainer/>Home Assistant Container Part 1: Install Debian, Docker and Portainer</a></li></ul></p><p><div class=previous-post><a href="https://sequr.be/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/?ref=footer"><span style=font-weight:700>« Previous</span><br>Home Assistant Container Part 8: Update Home...</a><div class=next-post><a href="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/?ref=footer"><span style=font-weight:700>Next »</span><br>Home Assistant Container Part 10: Zigbee2MQTT</a></div></p></div></footer></article></section><aside class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#install-esphome-container>Install ESPHome container</a><ul><li><a href=#docker-compose>Docker-compose</a></li><li><a href=#start-and-access-esphome>Start and access ESPHome</a></li></ul></li><li><a href=#home-assistant-sidebar>Home Assistant Sidebar</a></li><li><a href=#connecting-and-flashing-a-device>Connecting and flashing a device</a><ul><li><a href=#connecting-the-device-to-our-esphome-container>Connecting the device to our ESPHome container</a><ul><li><a href=#identify-the-device>Identify the device</a></li><li><a href=#forward-to-the-container>Forward to the container</a></li></ul></li><li><a href=#install-configuration-on-the-esp>Install configuration on the ESP</a></li><li><a href=#add-device-to-home-assistant>Add device to Home Assistant</a></li></ul></li></ul></nav></div></aside></div></body></html>