<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-US lang=en-US><head><title itemprop=name>Home Assistant Container Part 5: Node-RED :: Sequr</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><meta name=url content="https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/" itemprop=url><link rel=icon href=/favicon.ico><meta itemprop=name content="Home Assistant Container Part 5: Node-RED"><meta itemprop=description content="In this fifth part of the Home Assistant Container series we’ll add Node-RED for nice visual automations."><meta itemprop=datePublished content="2022-09-07T00:00:00+02:00"><meta itemprop=dateModified content="2024-09-05T00:00:00+02:00"><meta itemprop=wordCount content="1058"><meta itemprop=image content="https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,Docker-Compose,Node-RED"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/cover.png"><meta name=twitter:title content="Home Assistant Container Part 5: Node-RED"><meta name=twitter:description content="In this fifth part of the Home Assistant Container series we’ll add Node-RED for nice visual automations."><meta property="og:url" content="https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/"><meta property="og:site_name" content="Sequr"><meta property="og:title" content="Home Assistant Container Part 5: Node-RED"><meta property="og:description" content="In this fifth part of the Home Assistant Container series we’ll add Node-RED for nice visual automations."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-09-07T00:00:00+02:00"><meta property="article:modified_time" content="2024-09-05T00:00:00+02:00"><meta property="article:tag" content="Home Automation"><meta property="article:tag" content="Home Assistant"><meta property="article:tag" content="Container"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Docker-Compose"><meta property="article:tag" content="Node-RED"><meta property="og:image" content="https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/cover.png"><meta property="og:see_also" content="https://sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/"><meta property="og:see_also" content="https://sequr.be/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/"><meta property="og:see_also" content="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/"><meta property="og:see_also" content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/"><meta property="og:see_also" content="https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/"><meta name=description content="In this fifth part of the Home Assistant Container series we&rsquo;ll add Node-RED for nice visual automations."><meta property="og:updated_time" content="2024-09-05T00:00:00+02:00"><link rel=sitemap type=application/xml title=Sitemap href=https://sequr.be/sitemap.xml><link rel=alternate type=text/mf2+html href=https://sequr.be/><meta name=apple-mobile-web-app-title content="Home Assistant Container Part 5: Node-RED"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=webmention href=https://webmention.io/sequr.be/webmention><link rel=stylesheet href=/css/bundle.min.308a714c50df5143bc08878001fede0511b3f9022c4c129848a3643270ab2f10.css integrity="sha256-MIpxTFDfUUO8CIeAAf7eBRGz+QIsTBKYSKNkMnCrLxA=" crossorigin=anonymous><script defer type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js integrity="sha256-FFRTJhp3VfUEKoVMQhNQHSFaj740wI0YHED4A/ExXnQ=" crossorigin=anonymous></script></head><body class=dark-theme><div class=wrapper><aside class="sidebar h-card background-image"><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class="sidebar-about hcard"><h1 class=brand><a href=https://sequr.be/><img src=/logo.png class="u-logo u-photo" alt="Sequr brand image">
</a><a href=https://sequr.be/ class="u-url p-org"><h1>Sequr</h1></a></h1><p class="lead p-note">Writeups and random stuff about infosec and life</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/ title=About>About</a></li><li class=heading><a href=/blog/ title=Blog>Blog</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=/blog/2025/02/flashing-the-sonoff-powr3-with-tasmota/ title="Flashing the Sonoff POWR3 with Tasmota" hreflang=en>Tasmota on Sonoff POWR3</a></li><li class=bullet><a href=/blog/2025/01/sending-my-first-webmention-from-scratch/ title="Sending my first webmention from scratch" hreflang=en>My first Webmention</a></li><li class=bullet><a href=/blog/2025/01/bridging-this-blog-with-the-fediverse/ title="Bridging this blog with the Fediverse" hreflang=en>Briding with the Fediverse</a></li><li class=heading><a href=/shoppinglist/ title=Shopping>Shopping</a></li><li class=heading><a href=/privacy/ title=Privacy>Privacy</a></li></ul></nav><a target=_blank class=social title="Atom Feed" href=/atom.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><a href=https://bsky.app/profile/sequr.be target=_blank class="u-url social" rel="external noopener me" title=Bluesky><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://mastodon-belgium.be/@TerraGloba target=_blank class="u-url social" rel="external noopener me" title=Mastodon>
<svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18V8.91z"/></svg></a><a href=https://github.com/TheGroundZero target=_blank class="u-url social" rel="external noopener me" title=Github><svg width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a href=https://twitter.com/DezeStijn target=_blank class="u-url social" rel="external noopener me" title=Twitter><svg width="1.2em" height="1.2em" viewBox="0 0 16 16"><path fill="currentcolor" d="M5.032 14.286c6.037.0 9.34-4.837 9.34-9.032.0-.137.0-.274-.01-.41A6.56 6.56.0 0016 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207.0 001.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322.0 00-1.862-.958 3.384 3.384.0 00-2.082.334 3.223 3.223.0 00-1.442 1.49 3.08 3.08.0 00-.208 2.03 9.57 9.57.0 01-3.747-.963A9.269 9.269.0 011.114 2.292a3.086 3.086.0 00-.36 2.314c.189.787.68 1.475 1.376 1.924A3.344 3.344.0 01.64 6.132v.04c0 .734.263 1.444.743 2.01a3.3 3.3.0 001.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19.0 001.168 1.577 3.36 3.36.0 001.9.627A6.732 6.732.0 010 12.86a9.527 9.527.0 005.032 1.423"/></svg></a><a href=https://ko-fi.com/s4squatch target=_blank class="u-url social" rel="external noopener" title=Kofi><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>Sequr</a>
• <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="external noopener">CC BY-NC-SA 4.0</a></p><a href=https://sequr.be/en hreflang=en-US title=English class=u-translation-of rel=alternate><span class="flag fi fi-gb"></span>
</a><a href=https://sequr.be/nl hreflang=nl-BE title=Nederlands class=u-translation-of rel=alternate><span class="flag fi fi-nl"></span></a></div></aside><section class="content container"><article class="post h-entry"><header class=info><h1 class=post-title><a href=https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/ class="p-name u-url" rel=bookmark>Home Assistant Container Part 5: Node-RED</a></h1><div class=headline><div><span class="h-card p-author">DezeStijn</span><span class=whitespace> • </span><time datetime=2022-09-07T00:00:00+0200 class="post-date dt-published">Sep 7, 2022</time><span class=whitespace> </span><time datetime=2024-09-05T00:00:00+0200 class="post-date dt-updated">(Sep 5, 2024)
</time><span class=whitespace>• </span><span class=reading-time><span>5 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a class=p-category href=https://sequr.be/categories/home-automation>Home Automation</a></li><li class="tag-HA Container"><a class=p-category href=https://sequr.be/categories/ha-container>HA Container</a></li></ul></div><p class=seriesname>Series: <a class=p-category href=https://sequr.be/series/ha-container>HA Container</a></p></header><main class=e-content><h2 id=intro>Intro</h2><p>We&rsquo;re continuing where we left off after <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">Part 4: Mosquitto Docker Container</a>.</p><p>In this Part 4, we&rsquo;ll be adding <a href=https://nodered.org/ title=Node-RED rel=external target=_blank>Node-RED</a>, which will give us a visual and feature-rich method for automating stuff.
This is a personal preference and you may decide not to do this and stick to Home Assistant Automations instead.</p><h2 id=install-node-red-container>Install Node-RED container</h2><h3 id=docker-compose>Docker-compose</h3><p>We expand our <code>docker-compose.yaml</code> with the config for the Node-RED container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodered</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nodered</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nodered/node-red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;1880:1880/tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Europe/Brussels</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/opt/nodered/data:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>homeassistant</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mosquitto</span>
</span></span></code></pre></div><p>Because our Node-RED automations are reliant on Home Assistant and we may be doing some stuff over MQTT as well, we want to make sure our HA Container and Mosquitto broker are running.</p><h3 id=file-permissions>File permissions</h3><p>If we now launch the Node-RED container using <code>docker-compose up -d nodered</code> you might notice you&rsquo;re unable to open the web interface at <code>http://&lt;ip.of.our.box>:1880</code>.</p><p>Checking the logs in Portainer or by running <code>docker logs nodered</code>, you may notice file permissions errors:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>docker logs nodered
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Error: EACCES: permission denied, copyfile <span style=color:#e6db74>&#39;/usr/src/node-red/node_modules/node-red/settings.js&#39;</span> -&gt; <span style=color:#e6db74>&#39;/data/settings.js&#39;</span>
</span></span><span style=display:flex><span>    at Object.copyFileSync <span style=color:#f92672>(</span>node:fs:2817:3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at copyFile <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/fs-extra/lib/copy/copy-sync.js:73:6<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at onFile <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/fs-extra/lib/copy/copy-sync.js:59:25<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at getStats <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/fs-extra/lib/copy/copy-sync.js:51:44<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at handleFilterAndCopy <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/fs-extra/lib/copy/copy-sync.js:36:10<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at Object.copySync <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/fs-extra/lib/copy/copy-sync.js:29:10<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at Object.&lt;anonymous&gt; <span style=color:#f92672>(</span>/usr/src/node-red/node_modules/node-red/red.js:129:20<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at Module._compile <span style=color:#f92672>(</span>node:internal/modules/cjs/loader:1105:14<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at Object.Module._extensions..js <span style=color:#f92672>(</span>node:internal/modules/cjs/loader:1159:10<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    at Module.load <span style=color:#f92672>(</span>node:internal/modules/cjs/loader:981:32<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  errno: -13,
</span></span><span style=display:flex><span>  syscall: <span style=color:#e6db74>&#39;copyfile&#39;</span>,
</span></span><span style=display:flex><span>  code: <span style=color:#e6db74>&#39;EACCES&#39;</span>,
</span></span><span style=display:flex><span>  path: <span style=color:#e6db74>&#39;/usr/src/node-red/node_modules/node-red/settings.js&#39;</span>,
</span></span><span style=display:flex><span>  dest: <span style=color:#e6db74>&#39;/data/settings.js&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>node:internal/fs/utils:345
</span></span><span style=display:flex><span>    throw err;
</span></span><span style=display:flex><span>    ^
</span></span></code></pre></div><p>This has to do with how the mapping of users inside and outside a Docker container works.</p><p>Our Docker volume for the data directory was created by (and is owned by) our <code>root</code> user, who&rsquo;s ID are <code>uid=0 gid=0</code>.
The <code>nodered</code> user inside the container, which owns the <code>/data</code> directory, however has different IDs: <code>1000:1000</code> (uid:gid).
We can fix this by changing the ownership of the Docker volume to the user with the ID <code>1000:1000</code> by running <code>sudo chown -R 1000:1000 /opt/nodered/data</code>.</p><p>Docker should notice the change in permissions and will restart the container.
If not, recreate the container from the Portainer interface.</p><p>We can now open the Node-RED interface at <code>http://&lt;ip.of.our.box>:1880</code>.</p><h2 id=home-assistant-config>Home Assistant config</h2><h3 id=sidebar>Sidebar</h3><p>As we did with Portainer in <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">Part 3</a>, we can add Node-RED to the sidebar of our Home Assistant dashboard using the <code>panel-iframe</code>.
This makes it easier to access Node-RED.</p><p><strong>Note:</strong> This has changed since <a href=https://www.home-assistant.io/blog/2024/04/03/release-20244/#webpage-dashboard title="2024.4 release notes - webpage dashboard" rel=external target=_blank>Home Assistant 2024.4</a>.
You can now use a <a href=https://www.home-assistant.io/dashboards/dashboards/#webpage-dashboard title="Webpage dashboard" rel=external target=_blank>Webpage Dashboard</a> to embed a webpage in your dashboard.</p><p><del>Add the following lines to <code>configuration.yaml</code>:</del></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Outdated, use web dashboard</span>
</span></span><span style=display:flex><span><span style=color:#f92672>panel_iframe</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>portainer</span>:     <span style=color:#75715e># part 3</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodered</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Node-RED</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>mdi:lan</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://192.168.10.106:1880/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>require_admin</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>Restart Home Assistant via the Developer Tools menu and you&rsquo;ll side Node-RED appear in the sidebar.</p><figure class=center><img src=nodered-sidebar.png alt="Home Assistant sidebar showing Node-RED shortcut"><figcaption class=center>Node-RED accessible from the sidebar</figcaption></figure><h3 id=access-token>Access Token</h3><p>In a minute we&rsquo;ll setup Node-RED to interface with Home Assistant.
To set up this connection, we will need a Long-Lived Access Token, so let&rsquo;s grab one.</p><p>Click on your username at the bottom of the Home Assistant sidebar and scroll down in the Profile page untill you see the Long-Lived Access Tokens section.</p><figure class=center><img src=ha-token.png alt="Access token section in profile page"><figcaption class=center>Create long-lived access tokens</figcaption></figure><p>Click create token and enter a name (e.g. <code>Node-RED</code>) for the token in the pop-up window.
Finally copy the access token and paste it somewhere safe as <strong>you won&rsquo;t be able to retrieve the token afterwards</strong>.</p><h2 id=node-red-configuration>Node-RED configuration</h2><p>Open the Node-RED interface either through the Home Assistant dashboard or by browsing to <code>http://&lt;ip.of.our.box>:1880</code>.</p><figure class=center><img src=nodered-welcome.png alt="Node-RED Welcome Screen"><figcaption class=center>Node-RED welcomes us</figcaption></figure><p>Feel free to go through the walkthrough.</p><h3 id=home-assistant-nodes>Home Assistant nodes</h3><p>First we need to add the Home Assistant nodes to Node-RED.</p><ol><li>Open the hamburger menu at the top-right and click <em>Manage Palette</em> to get an overview of available and installed nodes.</li><li>Open the <em>Install</em> tab.</li><li>Search for and install <code>node-red-contrib-home-assistant-websocket</code>.</li></ol><figure class=center><img src=nodered-palette.png alt="Node-RED Palette"><figcaption class=center>Install HA Websockets in the Palette</figcaption></figure><p>Next we need to set up the connection between Node-RED and Home Assistant.</p><ol><li>Back in the flow editor, drag a <code>events: all</code> node from the <em>Home Assistant</em> section to the editor.</li><li>Double-click the node to open its configuration.</li><li>Choose for <code>Add new server...</code> next to <em>Server</em> and click the pencil icon.</li><li>Give the server config a name (e.g. <code>Home Assistant</code>).</li><li>Do <strong>NOT</strong> check <code>Using the Home Assistant Add-on</code>.</li><li>Next to Base URL enter the address you use to access Home Assistant <code>http://&lt;ip.of.our.box>:8123</code>.</li><li>Enter the Access Token we got from Home Assistant a minute ago.</li><li>Add, Save, and Deploy to store the server config.</li></ol><p><figure class=center><img src=nodered-setup.png alt="Node-RED HA server setup"><figcaption class=center>Setting up the HA server connection</figcaption></figure><figure class=center><img src=nodered-setup2.png alt="Node-RED HA server setup details"><figcaption class=center>Entering the server details</figcaption></figure></p><p>From now on, we&rsquo;ll be able to communicate with Home Assistant from Node-RED.
We can listen for state changes and call services exposed by Home Assistant and HA integrations.</p><h4 id=deploy-tip>Deploy Tip</h4><p>You can choose to only deploy nodes that were added or modified so Node-RED doesn&rsquo;t restart all flows when deploying.</p><figure class=center><img src=nodered-deploy.png alt="Node-RED deploy dropdown"><figcaption class=center>Deploy in full, modified flows or modified nodes</figcaption></figure><h2 id=mqtt-and-node-red>MQTT and Node-RED</h2><p>Let&rsquo;s also setup a connection from Node-RED to our MQTT broker so we can directly communicate with devices over MQTT from Node-RED.</p><h3 id=mqtt-user>MQTT user</h3><p>I prefer to create an additional MQTT user for Node-RED.
This will allow us to track communications coming from Node-RED in the Mosquitto logs.</p><p>Open a terminal window, connect to the Docker machine and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it mosquitto mosquitto_passwd /mosquitto/config/mqttuser nodered
</span></span><span style=display:flex><span><span style=color:#75715e># Enter a password</span>
</span></span></code></pre></div><h3 id=node-red-setup>Node-RED setup</h3><p>This setup is fairly similar to how we setup the Home Assistant connection.
The main difference is that we don&rsquo;t need to add a package as MQTT is support by default.</p><ol><li>Add a MQTT node.</li><li>Double-click to open its configuration.</li><li>Add a new MQTT server.</li><li>In the <strong>Connection</strong> tab, fill in the Server address (<code>&lt;ip.of.our.box></code>) and Port (<code>1883</code>) of our broker, and pick a Client ID or let Node-RED generate a random one.<br>Note that I picked &ldquo;MQTT V3.1.1&rdquo; as Protocal, but feel free to select &ldquo;MQTT V5&rdquo; if you want to. Mosquitto supports both.</li><li>In the <strong>Security</strong> tab, enter the username and password for the MQTT user you just created.</li><li>Add, save, and deploy to store our changes.
Note that you may need to enter a MQTT topic to listen to, simply enter the <code>#</code> wildcard.</li></ol><figure class=center><img src=nodered-mqtt.png alt="Node-RED MQTT broker setup"><figcaption class=center>Connecting with MQTT broker</figcaption></figure><p>And with this part done, we can now setup the most exciting and visually pleasing automation flows and communicate directly with our MQTT broker without HA in-between.</p><p>Curious to see what I&rsquo;ll add to my system next?
Keep an eye open for the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">next</a> blog post(s).</p><h2 id=changelog>Changelog</h2><ul><li>2024-09-05 - Reference Webpage dashboard replacing <code>iframe_panel</code> since 2024.04</li></ul></main><hr><footer><div class=footer><p>This is a post in the <span style=font-weight:700><a href=https://sequr.be/series/ha-container>HA Container</a></span> series.<br>Other posts in this series:<ul class=series><li>Feb 12, 2024 -
<a href=/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/>Home Assistant Container Part 13: VS Code code-server</a></li><li>Dec 2, 2022 -
<a href=/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/>Home Assistant Container Part 12: Migrating to Podman</a></li><li>Nov 25, 2022 -
<a href=/blog/2022/11/home-assistant-container-part-11-bluetooth-support/>Home Assistant Container Part 11: Bluetooth support</a></li><li>Oct 4, 2022 -
<a href=/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/>Home Assistant Container Part 10: Zigbee2MQTT</a></li><li>Sep 15, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-9-esphome/>Home Assistant Container Part 9: ESPHome</a></li><li>Sep 11, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-8-update-home-assistant-container/>Home Assistant Container Part 8: Update Home Assistant Container</a></li><li>Sep 9, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/>Home Assistant Container Part 7: Backing up Home Assistant Container</a></li><li>Sep 8, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/>Home Assistant Container Part 6: Editing configuration.yaml from within Home Assistant</a></li><li>Sep 7, 2022 -
Home Assistant Container Part 5: Node-RED</li><li>Sep 5, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/>Home Assistant Container Part 4: Mosquitto Docker Container</a></li><li>Sep 3, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/>Home Assistant Container Part 3: MariaDB and InfluxDB</a></li><li>Sep 2, 2022 -
<a href=/blog/2022/09/home-assistant-container-part-2-home-assistant-container/>Home Assistant Container Part 2: Home Assistant Container</a></li><li>Aug 31, 2022 -
<a href=/blog/2022/08/home-assistant-container-part-1-install-debian-docker-and-portainer/>Home Assistant Container Part 1: Install Debian, Docker and Portainer</a></li></ul></p><p><div class=previous-post><a href="https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/?ref=footer"><span style=font-weight:700>« Previous</span><br>Home Assistant Container Part 4: Mosquitto Docker...</a><div class=next-post><a href="https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/?ref=footer"><span style=font-weight:700>Next »</span><br>Home Assistant Container Part 6: Editing...</a></div></p></div></footer></article></section><aside class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#install-node-red-container>Install Node-RED container</a><ul><li><a href=#docker-compose>Docker-compose</a></li><li><a href=#file-permissions>File permissions</a></li></ul></li><li><a href=#home-assistant-config>Home Assistant config</a><ul><li><a href=#sidebar>Sidebar</a></li><li><a href=#access-token>Access Token</a></li></ul></li><li><a href=#node-red-configuration>Node-RED configuration</a><ul><li><a href=#home-assistant-nodes>Home Assistant nodes</a><ul><li><a href=#deploy-tip>Deploy Tip</a></li></ul></li></ul></li><li><a href=#mqtt-and-node-red>MQTT and Node-RED</a><ul><li><a href=#mqtt-user>MQTT user</a></li><li><a href=#node-red-setup>Node-RED setup</a></li></ul></li><li><a href=#changelog>Changelog</a></li></ul></nav></div></aside></div></body></html>